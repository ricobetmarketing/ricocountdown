<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rico.bet VIP | Thermal Hunt</title>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --gold: #ffca28;
      --gold-glow: rgba(255, 202, 40, 0.3);
      --bg-dark: #0a0a0b;
      --card-bg: rgba(18, 18, 20, 0.98);
      --border: rgba(255, 202, 40, 0.2);
      --neon-blue: #22d3ee;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--bg-dark);
      background-image: 
        radial-gradient(circle at 50% -20%, rgba(255, 202, 40, 0.1), transparent 50%),
        radial-gradient(circle at 0% 100%, rgba(34, 211, 238, 0.05), transparent 40%);
      color: #fff;
      font-family: 'Orbitron', sans-serif;
      padding: 15px;
    }

    /* Main Container */
    .game-wrap {
      width: 100%;
      max-width: 420px;
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 24px;
      padding: 24px;
      box-shadow: 0 40px 100px rgba(0,0,0,0.8);
      position: relative;
      overflow: hidden;
    }

    /* Header Styling */
    h1 {
      font-family: 'Cinzel';
      font-size: 1.2rem;
      text-align: center;
      color: var(--gold);
      margin: 0 0 5px 0;
      letter-spacing: 2px;
    }

    .sub-header {
      font-size: 10px;
      text-align: center;
      color: #666;
      margin-bottom: 20px;
      letter-spacing: 1px;
    }

    /* Minimalist Status Bar */
    .gate-status-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(255,255,255,0.03);
      padding: 12px 18px;
      border-radius: 12px;
      margin-bottom: 15px;
      border: 1px solid rgba(255,255,255,0.05);
    }

    .status-tag {
      font-size: 11px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #444;
    }

    .live .status-dot {
      background: var(--neon-blue);
      box-shadow: 0 0 10px var(--neon-blue);
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0% { opacity: 1; } 50% { opacity: 0.4; } 100% { opacity: 1; }
    }

    /* Scanner Field */
    #scanner-box {
      height: 380px;
      border-radius: 16px;
      background: #000;
      position: relative;
      overflow: hidden;
      border: 1px solid rgba(255,255,255,0.08);
      cursor: crosshair;
    }

    /* Tactical Overlay (Closed State) */
    .lock-overlay {
      position: absolute;
      inset: 0;
      background: rgba(10, 10, 11, 0.95);
      backdrop-filter: blur(8px);
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      z-index: 100;
      padding: 30px;
    }

    .lock-overlay.show { display: flex; }

    .big-timer {
      font-size: 2.2rem;
      color: var(--gold);
      margin: 10px 0;
      font-weight: 700;
    }

    .lock-hint {
      font-size: 11px;
      color: #555;
      line-height: 1.6;
      margin-top: 15px;
    }

    /* Torch Effect */
    #torch {
      position: absolute;
      width: 150px;
      height: 150px;
      background: radial-gradient(circle, rgba(255, 202, 40, 0.2) 0%, transparent 75%);
      pointer-events: none;
      transform: translate(-50%, -50%);
      z-index: 10;
      display: none;
    }

    /* Mascots */
    .mascot-target {
      position: absolute;
      opacity: 0;
      transition: opacity 0.2s ease;
      cursor: pointer;
      z-index: 5;
    }

    .mascot-target.found {
      opacity: 1 !important;
      filter: drop-shadow(0 0 15px var(--gold));
      pointer-events: none;
    }

    #m1-count {
      text-align: center;
      margin-top: 20px;
      font-size: 12px;
      color: var(--gold);
      letter-spacing: 2px;
    }

    /* Modal Styling */
    .modal-back {
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.85);
      backdrop-filter: blur(4px);
      display: none; align-items: center; justify-content: center;
      z-index: 9999; padding: 20px;
    }
    .modal-back.show { display: flex; }
    .modal {
      background: #151517;
      border: 1px solid var(--border);
      border-radius: 20px;
      width: 100%; max-width: 350px;
      padding: 25px;
      text-align: center;
    }
    .code-box {
      margin: 20px 0;
      padding: 15px;
      background: rgba(255,202,40,0.05);
      border: 1px dashed var(--gold);
      color: var(--gold);
      font-weight: bold;
      letter-spacing: 1px;
    }
    .modal-btn {
      background: var(--gold);
      border: none;
      padding: 12px 30px;
      border-radius: 8px;
      font-weight: bold;
      font-family: 'Orbitron';
      cursor: pointer;
    }
  </style>
</head>
<body>

<div class="game-wrap">
  <h1>THERMAL HUNT</h1>
  <div class="sub-header">BETA-VERSION // VIP ACCESS ONLY</div>
  
  <div class="gate-status-bar" id="statusWrapper">
    <div class="status-tag" id="dropBadge">
      <span class="status-dot"></span>
      <span id="status-text">SYSTEM STANDBY</span>
    </div>
    <div style="font-size: 10px; color: #666;" id="gateLabel">--:--</div>
  </div>

  <div id="scanner-box" onmousemove="handleScan(event)" ontouchmove="handleScan(event)">
    <div id="torch"></div>
    
    <div class="lock-overlay show" id="m1LockOverlay">
      <div style="font-size: 10px; color: #888; letter-spacing: 2px;">SYNCHRONIZING GATE</div>
      <div class="big-timer" id="overlayTimer">00:00:00</div>
      <div class="lock-hint" id="lockMsg">
        The reward gate is currently offline.<br>Please return during the next scheduled window.
      </div>
    </div>

    <img src="https://ricobr.ft-crm.com/media-api/serve/9cc65950-210b-4f56-995f-e4a94dd1d82c_2.png"
         class="mascot-target" style="top: 15%; left: 10%; width: 65px;" onclick="findMascot(this)">
    <img src="https://ricobr.ft-crm.com/media-api/serve/9cc65950-210b-4f56-995f-e4a94dd1d82c_2.png"
         class="mascot-target" style="top: 65%; left: 45%; width: 45px;" onclick="findMascot(this)">
    <img src="https://ricobr.ft-crm.com/media-api/serve/9cc65950-210b-4f56-995f-e4a94dd1d82c_2.png"
         class="mascot-target" style="top: 35%; left: 70%; width: 55px;" onclick="findMascot(this)">
  </div>

  <div id="m1-count">SCANNER INACTIVE</div>
</div>

<div class="modal-back" id="modalBack">
  <div class="modal">
    <h2 style="font-family: 'Cinzel'; color: var(--gold); margin-top: 0;">MISSION CLEAR</h2>
    <p style="font-size: 12px; color: #aaa;">Target acquired. Use the code below on Rico.bet</p>
    <div class="code-box" id="voucherCode">------</div>
    <button class="modal-btn" onclick="hideModal()">CONFIRM</button>
  </div>
</div>

<script>
  /***********************
   * CONFIG & CONSTANTS
   ***********************/
  const API_URL = "https://script.google.com/macros/s/AKfycbyVFH-uY4zaWpbccUe4gGtDJJaZL9S4VxrjA9U3ifmHUAt02XrK6GpU5niyh6hRQRBBmA/exec";
  const GATES = [
    { h: 0, m: 0, label: "12:00 AM" },
    { h: 9, m: 0, label: "9:00 AM"  },
    { h: 13, m: 0, label: "1:00 PM"  },
    { h: 17, m: 0, label: "5:00 PM"  },
    { h: 21, m: 0, label: "9:00 PM"  },
  ];
  const OPEN_WINDOW_MINUTES = 30;
  const UTC3_OFFSET_MIN = -180;

  let currentGateState = "CLOSED";
  let m1Count = 0;

  /***********************
   * TIME LOGIC
   ***********************/
  function getNowUtc3() {
    return new Date(Date.now() + UTC3_OFFSET_MIN * 60 * 1000);
  }

  function formatTime(sec) {
    const h = Math.floor(sec / 3600);
    const m = Math.floor((sec % 3600) / 60);
    const s = Math.floor(sec % 60);
    return `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
  }

  function updateLogic() {
    const d = getNowUtc3();
    const now = new Date(Date.UTC(d.getUTCFullYear(), d.getUTCMonth(), d.getUTCDate(), d.getUTCHours(), d.getUTCMinutes(), d.getUTCSeconds()));
    
    let activeGate = null;
    let nextGate = null;

    for (const g of GATES) {
      const start = new Date(Date.UTC(d.getUTCFullYear(), d.getUTCMonth(), d.getUTCDate(), g.h, g.m));
      const end = new Date(start.getTime() + OPEN_WINDOW_MINUTES * 60 * 1000);
      
      if (now >= start && now < end) {
        activeGate = { g, end };
        break;
      }
      if (now < start && !nextGate) {
        nextGate = { g, start };
      }
    }

    if (!nextGate && !activeGate) {
      const g0 = GATES[0];
      const start = new Date(Date.UTC(d.getUTCFullYear(), d.getUTCMonth(), d.getUTCDate() + 1, g0.h, g0.m));
      nextGate = { g: g0, start };
    }

    const badge = document.getElementById('statusWrapper');
    const statusText = document.getElementById('status-text');
    const overlay = document.getElementById('m1LockOverlay');
    const torch = document.getElementById('torch');

    if (activeGate) {
      currentGateState = "OPEN";
      badge.className = "gate-status-bar live";
      statusText.innerText = "GATE LIVE";
      overlay.classList.remove('show');
      torch.style.display = 'block';
      document.getElementById('gateLabel').innerText = "CLOSES IN: " + formatTime((activeGate.end - now)/1000);
      document.getElementById('m1-count').innerText = `ANALYSIS: ${m1Count}/3 DETECTED`;
    } else {
      currentGateState = "CLOSED";
      badge.className = "gate-status-bar";
      statusText.innerText = "GATE OFFLINE";
      overlay.classList.add('show');
      torch.style.display = 'none';
      document.getElementById('overlayTimer').innerText = formatTime((nextGate.start - now)/1000);
      document.getElementById('gateLabel').innerText = "NEXT: " + nextGate.g.label;
      document.getElementById('m1-count').innerText = "SCANNER INACTIVE";
    }
  }

  /***********************
   * GAMEPLAY
   ***********************/
  function handleScan(e) {
    if (currentGateState !== "OPEN") return;

    const torch = document.getElementById('torch');
    const box = document.getElementById('scanner-box').getBoundingClientRect();
    const x = (e.clientX || (e.touches && e.touches[0].clientX)) - box.left;
    const y = (e.clientY || (e.touches && e.touches[0].clientY)) - box.top;

    torch.style.left = x + 'px';
    torch.style.top  = y + 'px';

    document.querySelectorAll('.mascot-target').forEach(m => {
      if(m.classList.contains('found')) return;
      const mx = m.offsetLeft + (m.clientWidth/2);
      const my = m.offsetTop + (m.clientHeight/2);
      const dist = Math.sqrt(Math.pow(x - mx, 2) + Math.pow(y - my, 2));
      
      // Reveal when torch is close
      if(dist < 70) m.style.opacity = (70 - dist) / 70;
      else m.style.opacity = 0;
    });
  }

  function findMascot(el) {
    if (currentGateState !== "OPEN" || el.classList.contains('found')) return;
    el.classList.add('found');
    m1Count++;
    document.getElementById('m1-count').innerText = `ANALYSIS: ${m1Count}/3 DETECTED`;
    if(m1Count === 3) setTimeout(claimReward, 500);
  }

  async function claimReward() {
    const key = localStorage.getItem("rico_claimKey") || "CK-" + Math.random().toString(36).slice(2);
    localStorage.setItem("rico_claimKey", key);

    try {
      const res = await fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: new URLSearchParams({ action: "claim", mission: "M1", claimKey: key })
      });
      const data = await res.json();
      
      if(data.ok) {
        document.getElementById('voucherCode').innerText = data.voucher;
        document.getElementById('modalBack').classList.add('show');
      } else {
        alert(data.error || "Gate closed or fully redeemed.");
        location.reload();
      }
    } catch(e) {
      alert("Connection error. Try again.");
    }
  }

  function hideModal() { document.getElementById('modalBack').classList.remove('show'); }

  setInterval(updateLogic, 1000);
  updateLogic();
</script>

</body>
</html>
